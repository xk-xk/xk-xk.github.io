<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nuxt.js | 前端笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="前端笔记">
    
    <link rel="preload" href="/assets/css/0.styles.869ac584.css" as="style"><link rel="preload" href="/assets/js/app.200bbb95.js" as="script"><link rel="preload" href="/assets/js/2.6de0ece2.js" as="script"><link rel="preload" href="/assets/js/6.7faf298f.js" as="script"><link rel="prefetch" href="/assets/js/10.4c7ec131.js"><link rel="prefetch" href="/assets/js/11.bc784b5e.js"><link rel="prefetch" href="/assets/js/12.22255d0b.js"><link rel="prefetch" href="/assets/js/13.560e9cc4.js"><link rel="prefetch" href="/assets/js/14.babc9c91.js"><link rel="prefetch" href="/assets/js/15.b2d336b1.js"><link rel="prefetch" href="/assets/js/16.7b6ffe26.js"><link rel="prefetch" href="/assets/js/17.bd300d84.js"><link rel="prefetch" href="/assets/js/18.6a9508d4.js"><link rel="prefetch" href="/assets/js/19.381acccf.js"><link rel="prefetch" href="/assets/js/20.bc5642c8.js"><link rel="prefetch" href="/assets/js/21.2c45007a.js"><link rel="prefetch" href="/assets/js/22.21b94e44.js"><link rel="prefetch" href="/assets/js/3.2edd2080.js"><link rel="prefetch" href="/assets/js/4.c46daee1.js"><link rel="prefetch" href="/assets/js/5.1484f066.js"><link rel="prefetch" href="/assets/js/7.aaf42974.js"><link rel="prefetch" href="/assets/js/8.77b2fe6e.js"><link rel="prefetch" href="/assets/js/9.824c7080.js">
    <link rel="stylesheet" href="/assets/css/0.styles.869ac584.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/program-specs/" class="nav-link">
  代码规范
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">
  Vue
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  设计思想
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/program-specs/" class="nav-link">
  代码规范
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">
  Vue
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  设计思想
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vue/" aria-current="page" class="sidebar-link">概述</a></li><li><a href="/vue/vuejs.html" class="sidebar-link">Vue.js</a></li><li><a href="/vue/nuxtjs.html" aria-current="page" class="active sidebar-link">Nuxt.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#seo" class="sidebar-link">SEO</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#预渲染" class="sidebar-link">预渲染</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#服务端渲染-通过ssr" class="sidebar-link">服务端渲染（通过SSR）</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#异步请求" class="sidebar-link">异步请求</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#generate打包" class="sidebar-link">generate打包</a></li><li class="sidebar-sub-header"><a href="/vue/nuxtjs.html#build打包" class="sidebar-link">build打包</a></li></ul></li><li><a href="/vue/uniapp.html" class="sidebar-link">uni-app</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nuxt-js"><a href="#nuxt-js" class="header-anchor">#</a> Nuxt.js</h1> <p><a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer">Nuxt.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个基于 <a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer">Vue.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的服务端渲染应用框架。</p> <h2 id="seo"><a href="#seo" class="header-anchor">#</a> SEO</h2> <p>SEO（Search Engine Optimization），就是搜索引擎优化。是指为了增加网页在搜索引擎自然搜索结果中的收录数量以及提升排序位置而做的优化行为。</p> <p>实现 SEO 需要具备的条件：</p> <ol><li>打包生成多个页面。</li> <li>每个页面生成单独的 <code>title</code>、描述、关键字</li> <li>查看网页源代码得存在页面元素的代码</li></ol> <p>在前后端分离进行开发的情况下实现 SEO 前端主要有两种方式：一是预渲染，二是服务端渲染。</p> <h2 id="预渲染"><a href="#预渲染" class="header-anchor">#</a> 预渲染</h2> <ol><li><p>下载插件 <code>prerender-spa-plugin</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save prerender-spa-plugin
<span class="token function">npm</span> <span class="token function">install</span> --save vue-meta-info 
</code></pre></div></li> <li><p><code>vue.config.js</code> 中进行配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> PrerenderSPAPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'prerender-spa-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Renderer <span class="token operator">=</span> PrerenderSPAPlugin<span class="token punctuation">.</span>PuppeteerRenderer
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">PrerenderSPAPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    staticDir<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/message'</span><span class="token punctuation">,</span> <span class="token string">'/link'</span><span class="token punctuation">,</span> <span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token string">'/detail/id'</span><span class="token punctuation">,</span> <span class="token string">&quot;/search&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要做 seo 的路由</span>
                    renderer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Renderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        inject<span class="token operator">:</span> <span class="token punctuation">{</span>
                            foo<span class="token operator">:</span> <span class="token string">'bar'</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        headless<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        renderAfterDocumentEvent<span class="token operator">:</span> <span class="token string">'render-event'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>修改 <code>main.js</code> 中的内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//引入metainfo</span>
<span class="token keyword">import</span> MetaInfo <span class="token keyword">from</span> <span class="token string">'vue-meta-info'</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>MetaInfo<span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">//添加下面这行</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'render-event'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在对应页面添加 <code>metaInfo</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code>export default {
    name: &quot;About&quot;,
    metaInfo: {
        title: &quot;网页设计，模板分享，源码下载 - 糊涂博客&quot;,
        meta: [
            {
                name: &quot;keyWords&quot;,
                content: &quot;网页,简介,个人,小程序,博客&quot;,
            },
            {
                name: &quot;description&quot;,
                content:
                    &quot;糊涂个人博客，一位编程爱好者的成长地。专注于前后端的学习，不定期更新分享踩坑过程，学习记录、网页模板、demo源码等，也希望借此能够认识更多的朋友。&quot;,
            },
        ],
    },
}
</code></pre></div></li></ol> <p><strong>存在的问题：</strong></p> <ul><li><p>如果是多个页面需要做 SEO ，一个个配置路由会很麻烦</p></li> <li><p>无法动态配置路由</p> <p>如果是新闻详情或是商品详情需要做 SEO，它们的路由是这样的： <code>/news/:id</code> ，没有办法一个个添加</p></li> <li><p>无法动态配置 <code>metaInfo</code></p> <p>还是详情页，如果 <code>title</code>、描述、关键字需要通过接口获取动态添加，使用 <code>vue-meta-info</code> 插件无法实现</p></li> <li><p>基于以上几点，预渲染只适合某几个页面需要做 SEO，并且不是动态路由，不需要动态添加 <code>metaInfo</code> 的项目</p></li></ul> <h2 id="服务端渲染-通过ssr"><a href="#服务端渲染-通过ssr" class="header-anchor">#</a> 服务端渲染（通过SSR）</h2> <p>适合的项目：一个项目可能所有页面都要做 SEO，并且需要动态配置路由，动态设置 meta 信息</p> <p>方案： <code>Nuxt.js</code></p> <h1 id="nuxt"><a href="#nuxt" class="header-anchor">#</a> Nuxt</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>为了快速入门，Nuxt.js 团队创建了脚手架工具 <a href="https://github.com/nuxt/create-nuxt-app" target="_blank" rel="noopener noreferrer">create-nuxt-app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>确保安装了 npx（npx 在 NPM 版本 5.2.0 默认安装了）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx create-nuxt-app <span class="token operator">&lt;</span>项目名<span class="token operator">&gt;</span>
</code></pre></div><p>它会让你进行一些选择，根据项目需要进项选择，选择完后，它将安装所有依赖项，下一步启动项目:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run dev
</code></pre></div><h2 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h2> <p>对比 <code>vue-cli</code> 项目中的目录结构</p> <table><thead><tr><th>nuxt</th> <th>vue-cli</th> <th>功能/差异</th></tr></thead> <tbody><tr><td>layouts</td> <td>App.vue</td> <td>nuxt中用于自定义全局或页面布局，类似于 vue-cli 中的 App.vue</td></tr> <tr><td>middleware</td> <td>路由守卫</td> <td>nuxt 中的路由是根据pages目录结构自动生成，因此没有路由守卫，通过middleware中间件可以实现类似功能</td></tr> <tr><td>plugins</td> <td>-</td> <td>插件</td></tr> <tr><td>pages</td> <td>/src/views</td> <td>存放页面</td></tr> <tr><td>components</td> <td>/src/components</td> <td>存放组件</td></tr> <tr><td>statics</td> <td>/src/assets</td> <td>存放静态资源</td></tr> <tr><td>store</td> <td>/src/store</td> <td>vuex 状态树</td></tr> <tr><td>nuxt.config.js</td> <td>vue.config.js</td> <td>全局配置文件</td></tr></tbody></table> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <img src="/assets/img/nuxt-lifecircle.f4dd59a1.svg" style="zoom:80%;"> <p><code>nuxtServerInit</code> 方法会在服务端初始化的时候被调用，通常用来向服务端获取初始数据传到客户端，它配置在 <code>store/action.js</code> 中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关键代码</span>
    <span class="token keyword">async</span> <span class="token function">nuxtServerInit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commit<span class="token punctuation">,</span> state<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> req<span class="token punctuation">,</span> app <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nuxtServerInit 执行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>xx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> domain <span class="token operator">=</span> <span class="token string">&quot;https://&quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>host
      <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>$axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> xx <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>xx
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">,</span> xx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <p><code>Nuxt.js</code> 依据 <code>pages</code> 目录结构自动生产 <code>vue-router</code> 的模块路由配置，生成的结构可在 <code>.nuxt/router.js</code> 中查看。</p> <blockquote><p>页面之前跳转建议使用声明式导航而不是编程式导航，这样跟有利于 SEO 优化。</p> <p><code>&lt;nuxt-link&gt;</code> 会在源码中解析为 <code>a</code> 标签。</p></blockquote> <p>例如：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nuxt-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nuxt-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其他动态路由和嵌套路由可查看 <a href="https://www.nuxtjs.cn/guide/routing" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="异步请求"><a href="#异步请求" class="header-anchor">#</a> 异步请求</h2> <p><em>Nuxt.js 扩展了 Vue.js，增加了一个叫</em> <code>asyncData</code> <em>的方法，使得我们可以在设置组件的数据之前能异步获取或处理数据。</em></p> <p><code>asyncData</code>方法会在组件（<strong>限于页面组件</strong>）每次加载之前被调用。它可以在服务端或路由更新之前被调用。在这个方法被调用的时候，第一个参数被设定为当前页面的<a href="https://www.nuxtjs.cn/api#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener noreferrer">上下文对象<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，你可以利用 <code>asyncData</code>方法来获取数据，Nuxt.js 会将 <code>asyncData</code> 返回的数据融合组件 <code>data</code> 方法返回的数据一并返回给当前组件。</p> <blockquote><p>注意：由于<code>asyncData</code>方法是在组件 <strong>初始化</strong> 前被调用的，所以在方法内是没有办法通过 <code>this</code> 来引用组件的实例对象。</p></blockquote> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> hid<span class="token operator">:</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keywords <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> hid<span class="token operator">:</span> <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;keywords&quot;</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keywords <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> error<span class="token punctuation">,</span> store <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getProduct</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>productId<span class="token punctuation">)</span>
          <span class="token keyword">let</span> propdutDetail <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>propdutDetail
          <span class="token keyword">let</span> title <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title
          <span class="token keyword">let</span> keywords <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keywords

          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            propdutDetail<span class="token punctuation">,</span>
            keywords<span class="token punctuation">,</span>
            title<span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
          <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span> statusCode<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">&quot;服务器异常，请稍后再试&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>需要注意的点：</p> <ol><li><code>asyncData</code> 中不能通过 <code>this</code> 来引用实例对象，所以传参只能在 <code>params</code> 中获取，并且给 <code>data</code> 中的赋值应通过 <code>return</code> 一个对象，而不是 <code>this.xx = xx</code> 来做。</li> <li>获取数据也可以通过在其他生命周期调用接口，例如 <code>created、mounted</code> ，但是如果是需要做 SEO 的页面必须在组件初始化之前获取数据，就必须在 <code>asyncData</code> 中调用。</li> <li>动态设置 <code>head</code> 中的信息，接口必须在 <code>asyncData</code> 中调用。</li></ol> <h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <p>由于 <code>Nuxt</code> 路由是自动生成的，所以没有 <code>vue-cli</code> 那样的全局路由守卫，但是它有中间件的存在，在每次渲染页面之前调用，可以实现路由守卫的效果。</p> <p>每一个中间件应放置在 <code>middleware/</code> 目录。文件名的名称将成为中间件名称 (<code>middleware/auth.js</code>将成为 <code>auth</code> 中间件)。</p> <p>配置：</p> <ol><li><p><code>nuxt.config.js</code> 中全局配置，每个页面都会执行</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  router<span class="token operator">:</span> <span class="token punctuation">{</span>
    middleware<span class="token operator">:</span> <span class="token string">'auth'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>pages/index.vue</code> 页面组件中配置，只在配置的页面调用</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  middleware<span class="token operator">:</span> <span class="token string">'stats'</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li><code>layouts/default.vue</code> 布局中配置，只在引用的布局中调用</li></ol> <p><code>middleware/auth.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getRefreshToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/utils/auth.js&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> route<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> params<span class="token punctuation">,</span> query<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getRefreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>route<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>order.vue</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	middleware<span class="token operator">:</span> <span class="token string">'auth'</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="打包部署"><a href="#打包部署" class="header-anchor">#</a> 打包部署</h1> <p>打包方式有两种，一种是 <code>generate</code> 打包，一种是 <code>build</code>  打包</p> <h2 id="generate打包"><a href="#generate打包" class="header-anchor">#</a> generate打包</h2> <ol><li>使用generate打包后每个对应的页面都会生成一个html，你在打包的时候不能关闭后台，他会请求后台数据生成首屏的数据</li> <li>这样打包有一个弊端，当你首屏的数据发生更改的时候，他还是显示的是之前的数据，要想改变的话，需要重新打包发布才行。</li> <li>打包之后每个页面都生成了HTML页面，只有首屏的数据是之前渲染好了，但是其它数据还是从后台获取，比如翻页，第二页数据是重新请求后台的，你再次返回第一页也是再次请求的。</li></ol> <p>打包方式：执行 <code>npm run generate</code> 会生成 <code>dist</code> 文件夹，放到服务器就好了</p> <h2 id="build打包"><a href="#build打包" class="header-anchor">#</a> build打包</h2> <ol><li><code>npm run build</code></li> <li>服务器需要安装node，但node版本还不能过高，过高会有问题。我安装的是12.3.1</li> <li>执行命令之后需要把下面这几个文件/文件夹放到服务器上 .nuxt / static / nuxt.config.js /package.json</li> <li>放到服务器上面之后执行 <code>npm i</code> 安装依赖包。</li> <li>执行命令 <code>npm start</code> 项目就可以运行了</li></ol> <p><strong>但是服务器上不可能用命令窗口来启动项目的，万一命令窗口关闭的话我们的项目就跑不起来了，然后就要使用pm2进行进程托管了。这样命令窗口关闭也不会影响项目运行。</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2022/4/3 11:13:38</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/vuejs.html" class="prev">
        Vue.js
      </a></span> <span class="next"><a href="/vue/uniapp.html">
        uni-app
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.200bbb95.js" defer></script><script src="/assets/js/2.6de0ece2.js" defer></script><script src="/assets/js/6.7faf298f.js" defer></script>
  </body>
</html>
