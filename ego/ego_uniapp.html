<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>买家小程序 | 前端技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="继电器资缘网前端技术文档">
    
    <link rel="preload" href="/assets/css/0.styles.22fef927.css" as="style"><link rel="preload" href="/assets/js/app.f4e7372f.js" as="script"><link rel="preload" href="/assets/js/2.5644ef08.js" as="script"><link rel="preload" href="/assets/js/15.f07bf7f1.js" as="script"><link rel="prefetch" href="/assets/js/10.f1b62ca6.js"><link rel="prefetch" href="/assets/js/11.e6a76e73.js"><link rel="prefetch" href="/assets/js/12.71e7aba0.js"><link rel="prefetch" href="/assets/js/13.ee0746a7.js"><link rel="prefetch" href="/assets/js/14.bf46544d.js"><link rel="prefetch" href="/assets/js/16.c6fb407e.js"><link rel="prefetch" href="/assets/js/17.fc23fb3f.js"><link rel="prefetch" href="/assets/js/18.b6c90823.js"><link rel="prefetch" href="/assets/js/19.e8d039e9.js"><link rel="prefetch" href="/assets/js/20.330c231e.js"><link rel="prefetch" href="/assets/js/21.64063066.js"><link rel="prefetch" href="/assets/js/22.3f5d725d.js"><link rel="prefetch" href="/assets/js/23.764328f3.js"><link rel="prefetch" href="/assets/js/24.8a169a61.js"><link rel="prefetch" href="/assets/js/25.95b301b7.js"><link rel="prefetch" href="/assets/js/26.96e512f4.js"><link rel="prefetch" href="/assets/js/27.ba069998.js"><link rel="prefetch" href="/assets/js/28.a2af6576.js"><link rel="prefetch" href="/assets/js/29.f7e9ed6a.js"><link rel="prefetch" href="/assets/js/3.ffc637de.js"><link rel="prefetch" href="/assets/js/30.b4cd2f1c.js"><link rel="prefetch" href="/assets/js/31.78c0ed59.js"><link rel="prefetch" href="/assets/js/32.6314ea78.js"><link rel="prefetch" href="/assets/js/33.98431209.js"><link rel="prefetch" href="/assets/js/34.61b88a7a.js"><link rel="prefetch" href="/assets/js/35.0a226411.js"><link rel="prefetch" href="/assets/js/36.f3d90c1d.js"><link rel="prefetch" href="/assets/js/37.a6071a19.js"><link rel="prefetch" href="/assets/js/38.74df58ec.js"><link rel="prefetch" href="/assets/js/39.7c643a86.js"><link rel="prefetch" href="/assets/js/4.02e7ba69.js"><link rel="prefetch" href="/assets/js/40.55909e9a.js"><link rel="prefetch" href="/assets/js/41.eeb2ff7e.js"><link rel="prefetch" href="/assets/js/42.2ee98961.js"><link rel="prefetch" href="/assets/js/43.b0788c76.js"><link rel="prefetch" href="/assets/js/44.1149b63f.js"><link rel="prefetch" href="/assets/js/45.8c2fd675.js"><link rel="prefetch" href="/assets/js/46.68faf3a1.js"><link rel="prefetch" href="/assets/js/47.9130fb87.js"><link rel="prefetch" href="/assets/js/48.a10e69f3.js"><link rel="prefetch" href="/assets/js/49.4b7410be.js"><link rel="prefetch" href="/assets/js/5.9e8b646f.js"><link rel="prefetch" href="/assets/js/6.f2275d23.js"><link rel="prefetch" href="/assets/js/7.a979b898.js"><link rel="prefetch" href="/assets/js/8.c7bef64f.js"><link rel="prefetch" href="/assets/js/9.ef9a67d9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22fef927.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/summary/" class="nav-link">
  概述
</a></div><div class="nav-item"><a href="/program-specs/" class="nav-link">
  代码规范
</a></div><div class="nav-item"><a href="/vue-anchor/" class="nav-link">
  用户行为埋点
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术栈" class="mobile-dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tec-stack/vuex/" class="nav-link">
  vuex
</a></li><li class="dropdown-subitem"><a href="/tec-stack/axios/" class="nav-link">
  axios
</a></li><li class="dropdown-subitem"><a href="/tec-stack/nuxt/" class="nav-link">
  Nuxt.js
</a></li><li class="dropdown-subitem"><a href="/tec-stack/uniapp/" class="nav-link">
  uniapp
</a></li></ul></li><li class="dropdown-item"><h4>
          Electron
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/electron/" class="nav-link">
  vue cli plugin electron builder
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">PC前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">PC前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/zy_ssr.html" class="nav-link">
  资缘网主站(SSR)
</a></li><li class="dropdown-subitem"><a href="/web/zy_personel.html" class="nav-link">
  资缘网个人中心
</a></li><li class="dropdown-subitem"><a href="/web/zy_seller.html" class="nav-link">
  资缘网商家端
</a></li><li class="dropdown-subitem"><a href="/web/zy_admin.html" class="nav-link">
  资缘网平台端
</a></li><li class="dropdown-subitem"><a href="/web/zy_show.html" class="nav-link">
  资缘网PC云展
</a></li><li class="dropdown-subitem"><a href="/web/zy_chat.html" class="nav-link">
  资缘网客服系统
</a></li></ul></li><li class="dropdown-item"><h4>
          内部平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  平台中心
</a></li><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  绩效管理系统(web)
</a></li><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  绩效管理系统(admin)
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微信端" class="dropdown-title"><span class="title">微信端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微信端" class="mobile-dropdown-title"><span class="title">微信端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wechat/zy_wechat.html" class="nav-link">
  资缘网微信端
</a></li><li class="dropdown-subitem"><a href="/wechat/zy_show.html" class="nav-link">
  资缘网微信云展
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ego" class="dropdown-title"><span class="title">Ego</span> <span class="arrow down"></span></button> <button type="button" aria-label="Ego" class="mobile-dropdown-title"><span class="title">Ego</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ego/ego_uniapp.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  买家小程序
</a></li><li class="dropdown-subitem"><a href="/ego/ego_pc.html" class="nav-link">
  买家PC端
</a></li></ul></li><li class="dropdown-item"><h4>
          商家端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ego/ego_admin_pc.html" class="nav-link">
  商家PC端
</a></li><li class="dropdown-subitem"><a href="/ego/ego_admin_H5.html" class="nav-link">
  商家端H5
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://192.168.25.106/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  npm私仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://192.168.25.117/front" target="_blank" rel="noopener noreferrer" class="nav-link external">
  git私仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/summary/" class="nav-link">
  概述
</a></div><div class="nav-item"><a href="/program-specs/" class="nav-link">
  代码规范
</a></div><div class="nav-item"><a href="/vue-anchor/" class="nav-link">
  用户行为埋点
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术栈" class="dropdown-title"><span class="title">技术栈</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术栈" class="mobile-dropdown-title"><span class="title">技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tec-stack/vuex/" class="nav-link">
  vuex
</a></li><li class="dropdown-subitem"><a href="/tec-stack/axios/" class="nav-link">
  axios
</a></li><li class="dropdown-subitem"><a href="/tec-stack/nuxt/" class="nav-link">
  Nuxt.js
</a></li><li class="dropdown-subitem"><a href="/tec-stack/uniapp/" class="nav-link">
  uniapp
</a></li></ul></li><li class="dropdown-item"><h4>
          Electron
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/electron/" class="nav-link">
  vue cli plugin electron builder
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">PC前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">PC前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/zy_ssr.html" class="nav-link">
  资缘网主站(SSR)
</a></li><li class="dropdown-subitem"><a href="/web/zy_personel.html" class="nav-link">
  资缘网个人中心
</a></li><li class="dropdown-subitem"><a href="/web/zy_seller.html" class="nav-link">
  资缘网商家端
</a></li><li class="dropdown-subitem"><a href="/web/zy_admin.html" class="nav-link">
  资缘网平台端
</a></li><li class="dropdown-subitem"><a href="/web/zy_show.html" class="nav-link">
  资缘网PC云展
</a></li><li class="dropdown-subitem"><a href="/web/zy_chat.html" class="nav-link">
  资缘网客服系统
</a></li></ul></li><li class="dropdown-item"><h4>
          内部平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  平台中心
</a></li><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  绩效管理系统(web)
</a></li><li class="dropdown-subitem"><a href="/zh/miscellaneous/migration-guide.html" class="nav-link">
  绩效管理系统(admin)
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微信端" class="dropdown-title"><span class="title">微信端</span> <span class="arrow down"></span></button> <button type="button" aria-label="微信端" class="mobile-dropdown-title"><span class="title">微信端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wechat/zy_wechat.html" class="nav-link">
  资缘网微信端
</a></li><li class="dropdown-subitem"><a href="/wechat/zy_show.html" class="nav-link">
  资缘网微信云展
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ego" class="dropdown-title"><span class="title">Ego</span> <span class="arrow down"></span></button> <button type="button" aria-label="Ego" class="mobile-dropdown-title"><span class="title">Ego</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          用户端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ego/ego_uniapp.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  买家小程序
</a></li><li class="dropdown-subitem"><a href="/ego/ego_pc.html" class="nav-link">
  买家PC端
</a></li></ul></li><li class="dropdown-item"><h4>
          商家端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ego/ego_admin_pc.html" class="nav-link">
  商家PC端
</a></li><li class="dropdown-subitem"><a href="/ego/ego_admin_H5.html" class="nav-link">
  商家端H5
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="http://192.168.25.106/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  npm私仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://192.168.25.117/front" target="_blank" rel="noopener noreferrer" class="nav-link external">
  git私仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ego/" aria-current="page" class="sidebar-link">概览</a></li><li><a href="/ego/ego_uniapp.html" aria-current="page" class="active sidebar-link">买家小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ego/ego_uniapp.html#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/ego/ego_uniapp.html#打包发布" class="sidebar-link">打包发布</a></li><li class="sidebar-sub-header"><a href="/ego/ego_uniapp.html#技术要点" class="sidebar-link">技术要点</a></li></ul></li><li><a href="/ego/ego_pc.html" class="sidebar-link">买家PC端</a></li><li><a href="/ego/ego_admin_pc.html" class="sidebar-link">商家PC端</a></li><li><a href="/ego/ego_admin_H5.html" class="sidebar-link">商家端H5</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="买家小程序"><a href="#买家小程序" class="header-anchor">#</a> 买家小程序</h1> <p>此小程序采用 <a href="https://uniapp.dcloud.io/component/README" target="_blank" rel="noopener noreferrer">uniapp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为开发框架，并非原生微信小程序开发，开发者只需熟悉 <code>vue</code> 语法及相关前端基础结合官方文档即可快速上手。开发过程中使用 <code>HbuilderX</code> 编辑器编写代码，<code>微信开发者工具</code> 作为预览和调试工具。</p> <p>仓库地址： <a href="http://192.168.25.117/front/ego-uniapp" target="_blank" rel="noopener noreferrer">http://192.168.25.117/front/ego-uniapp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h2> <ol><li><p>使用 <code>HbuilderX</code> 导入项目：点击工具栏 <strong>文件</strong> =&gt; <strong>导入</strong> =&gt; <strong>从本地目录导入</strong></p></li> <li><p>导入成功后点击工具栏  <strong>运行</strong> =&gt; <strong>运行到小程序模拟器</strong> =&gt; <strong>微信开发者工具</strong>，等待控制台编译，编译成功后会自动打开微信开发者工具并运行。</p></li></ol> <p><strong>注意：</strong> 运行前需确保微信开发开发工具已登录并在小程序后台已加入开发者身份，否则会导致运行失败，无法自动打开微信开发者工具！</p> <h2 id="打包发布"><a href="#打包发布" class="header-anchor">#</a> 打包发布</h2> <p>步骤如下：</p> <ol><li><p>确认对应的分支是否正确，开发环境为  <code>dev</code>，测试环境为 <code>test</code>，生产环境根据对应的租户进行切换，如 资缘网 ：<code>ziyuanwang_525424_master</code> 。</p></li> <li><p>确认租户id <code>tenantId</code> 是否正确，打开配置文件 <code>config/app-config.js</code> ：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> tenantId <span class="token operator">=</span> <span class="token string">'535085'</span> <span class="token comment">// 租户id</span>
</code></pre></div><p>开发环境 <code>tenantId</code> 为 535085，测试环境为 772051，其他生产环境切换到对应的  <code>master</code> 分支，如 资缘网的分支为<code>ziyuanwang_525424_master</code> 则对应的 <code>tenantId</code> 为 525424。</p></li> <li><p>点击 <code>HbuilderX</code> 工具栏 <strong>发行</strong> =&gt; <strong>小程序-微信</strong>， 弹出确认框确认小程序名称和AppID无误后点击确定，等待控制台编译，编译完成后会自动启动微信开发者工具，点击微信开发者工具右上角的上传，输入版本号后确认上传。</p></li> <li><p>待上传成功后即可小程序后台查看最新版本，后续则根据需要做提交审核。</p></li></ol> <h2 id="技术要点"><a href="#技术要点" class="header-anchor">#</a> 技术要点</h2> <ol><li><p>确认 <code>config/app-config.js</code> 文件中的租户id（<code>tenantId</code>）一定要配置正确，项目中需要根据租户id获取对应租户的商品、租户信息等数据，以及 <code>config/http-config.js</code> 中接口地址的配置影响。</p></li> <li><p>新建一个功能页面时需要使用 <a href="https://uniapp.dcloud.io/collocation/manifest?id=%e5%85%b3%e4%ba%8e%e5%88%86%e5%8c%85%e4%bc%98%e5%8c%96%e7%9a%84%e8%af%b4%e6%98%8e" target="_blank" rel="noopener noreferrer">分包加载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，将目录建在根目录下而非直接在 <code>pages</code> 目录中，如新增一个订单模块即在根目录下新建 <code>pagesOrder</code> 文件夹，<code>pages.json</code> 中的文件路径应配置在 <code>subPackages</code> 中而不是 <code>pages</code> 。使用分包加载的原因在于微信官方对于小程序代码包的体积大小限制不能超过20M。</p></li> <li><p>沉浸式导航栏的实现（以首页为例）：</p> <p>pages.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/tabBar/home/home&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;首页&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;enablePullDownRefresh&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token property">&quot;navigationStyle&quot;</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span> <span class="token comment">// 关键代码：添加此属性后原生导航栏不显示</span>
			<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>home.vue</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
...
<span class="token comment">&lt;!-- 关键代码 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{height: titleBarHeight + <span class="token punctuation">'</span>px<span class="token punctuation">'</span>,paddingTop: statusBarHeight + <span class="token punctuation">'</span>px<span class="token punctuation">'</span>}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        自定义导航标题
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                statusBarHeight<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 手机状态栏高度</span>
        		titleBarHeight<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 自定义导航栏高度</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> SystemInfo <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>statusBarHeight <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>titleBarHeight <span class="token operator">=</span> <span class="token punctuation">(</span>uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span>
				uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>使用 <code>canvas</code> 生成海报并保存到本地相册（以首页分享为例）：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">canvas-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myCanvas<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">width</span><span class="token punctuation">:</span> 248px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 249px<span class="token punctuation">;</span> <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span> <span class="token property">top</span><span class="token punctuation">:</span> -10000000px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-bottom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>saveShareImg(canvasToFilepath)<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
        点击保存到相册
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        methods<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 生成海报</span>
            <span class="token keyword">async</span> <span class="token function">getAppletCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token operator">...</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>qrcode <span class="token operator">=</span> res<span class="token punctuation">.</span>data
					uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						title<span class="token operator">:</span> <span class="token string">'生成中...'</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">const</span> ctx <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
					ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token string">&quot;/static/imgs/qr-back@3x.png&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">,</span> <span class="token number">249</span><span class="token punctuation">)</span>
					<span class="token keyword">var</span> fs <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">var</span> imgPath <span class="token operator">=</span> wx<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">USER_DATA_PATH</span> <span class="token operator">+</span> <span class="token string">'/test.png'</span><span class="token punctuation">;</span>
					<span class="token keyword">var</span> imageData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>qrcode<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^data:image\/\w+;base64,</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// base64 图片无法直接通过 drawImage 绘制(模拟器可以，真机不行)，需要先保存一下到本地</span>
					fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						filePath<span class="token operator">:</span> imgPath<span class="token punctuation">,</span>
						data<span class="token operator">:</span> imageData<span class="token punctuation">,</span>
						encoding<span class="token operator">:</span> <span class="token string">'base64'</span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
							ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先保存状态 已便于画完圆再用</span>
							ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开始绘制</span>
							<span class="token comment">//先画个圆   前两个参数确定了圆心 （x,y） 坐标  第三个参数是圆的半径  四参数是绘图方向  默认是false，即顺时针</span>
							ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">90</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">90</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							ctx<span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//画了圆 再剪切  原始画布中剪切任意形状和尺寸。一旦剪切了某个区域，则所有之后的绘图都会被限制在被剪切的区域内</span>
							ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span>
							ctx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							ctx<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
								uni<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
									canvasId<span class="token operator">:</span> <span class="token string">'myCanvas'</span><span class="token punctuation">,</span>
									<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token comment">// 在H5平台下，tempFilePath 为 base64</span>
										<span class="token keyword">this</span><span class="token punctuation">.</span>canvasToFilepath <span class="token operator">=</span> res
											<span class="token punctuation">.</span>tempFilePath
										<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'绘制成功'</span><span class="token punctuation">)</span>
										fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
									<span class="token punctuation">}</span><span class="token punctuation">,</span>
									<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'绘制失败'</span><span class="token punctuation">)</span>
										fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 保存到手机</span>
            <span class="token function">saveShareImg</span><span class="token punctuation">(</span><span class="token parameter">canvasToTempFilePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>saveImageToPhotosAlbum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							<span class="token comment">// 如果没有则获取授权</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.writePhotosAlbum'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token comment">// 有则直接保存</span>
								wx<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
									filePath<span class="token operator">:</span> canvasToTempFilePath<span class="token punctuation">,</span>
									<span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
										wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
											title<span class="token operator">:</span> <span class="token string">'图片保存成功，快去分享到朋友圈吧~'</span><span class="token punctuation">,</span>
											icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
											duration<span class="token operator">:</span> <span class="token number">2000</span>
										<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span><span class="token punctuation">,</span>
									<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
										wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
											title<span class="token operator">:</span> <span class="token string">'保存失败'</span><span class="token punctuation">,</span>
											icon<span class="token operator">:</span> <span class="token string">'none'</span>
										<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.writePhotosAlbum'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token comment">// 申请了授权但是没有开启</span>
								uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
									title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
									content<span class="token operator">:</span> <span class="token string">'小程序申请相册权限'</span><span class="token punctuation">,</span>
									confirmText<span class="token operator">:</span> <span class="token string">&quot;去授权&quot;</span><span class="token punctuation">,</span>
									<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
										<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
											console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户点击确定'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
											wx<span class="token punctuation">.</span><span class="token function">openSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
												<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
													console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
												<span class="token punctuation">}</span>
											<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
										<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
											console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户点击取消'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
										<span class="token punctuation">}</span>
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.writePhotosAlbum'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token comment">// 没有开启授权</span>
								uni<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
								    scope<span class="token operator">:</span> <span class="token string">'scope.writePhotosAlbum'</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>根据网页链接跳转微信小程序</p> <p>业务场景：扫描h5商家端商品二维码跳转到小程序商品详情页，扫描代客下单生成的二维码跳转到小程序订单详情页。</p> <p>先进入小程序后台 <strong>开发管理</strong> =&gt; <strong>开发配置</strong> =&gt; <strong>配置普通链接二维码规则</strong></p> <p>二维码规则： <code>https://ego.relaysogo.com/716660/openMp</code></p> <p>小程序功能页面: <code>pages/transferpage/index</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> urlStr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>q<span class="token punctuation">)</span>
			<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseQueryString</span><span class="token punctuation">(</span>urlStr<span class="token punctuation">)</span>
			<span class="token comment">// console.log('二维码params',JSON.stringify(this.params))</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onload是否登录'</span><span class="token punctuation">,</span> <span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> params<span class="token punctuation">.</span>i
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        methods<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userLogin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">parseQueryString</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">var</span> str <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">var</span> iterms <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">var</span> arr<span class="token punctuation">,</span> Json <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iterms<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					arr <span class="token operator">=</span> iterms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					Json<span class="token punctuation">[</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> Json<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取参数</span>
				uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					title<span class="token operator">:</span> <span class="token string">'加载中...'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token function">queryParamsStr</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">let</span> urlStr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>urlStr <span class="token operator">=</span> urlStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res.urlStr'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>urlStr<span class="token punctuation">)</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseQueryString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>urlStr<span class="token punctuation">)</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res.params'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pagePush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>target <span class="token operator">!==</span> <span class="token string">&quot;orderDetail&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pagePush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
								url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pagesLogin/login?orderId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>orderId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">pagePush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					title<span class="token operator">:</span> <span class="token string">'跳转中...'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进入跳转this.urlStr'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>urlStr<span class="token punctuation">)</span>
				<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseQueryString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>urlStr<span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进入跳转.paramssss'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>
				<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">''</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">case</span> <span class="token string">'orderDetail'</span><span class="token operator">:</span>
						url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pagesOrder/orderDetail/orderDetail?orderId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>orderId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'productDetail'</span><span class="token operator">:</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>shareId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'shareId'</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>shareId<span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>specialId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							url <span class="token operator">=</span>
								<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pagesCommodity/commodity?itemId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>itemId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;specialId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>specialId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;shareId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>shareId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pagesCommodity/commodity?itemId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>itemId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;shareId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>shareId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">default</span><span class="token operator">:</span>
						<span class="token keyword">break</span>
				<span class="token punctuation">}</span>
				uni<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					url<span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
						uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
						uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'跳转失败'</span><span class="token punctuation">)</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'跳转失败'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">getWXAuthorityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						provider<span class="token operator">:</span> <span class="token string">'weixin'</span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取微信临时登录凭证成功：&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span>wxAuthorityCode <span class="token operator">=</span> res<span class="token punctuation">.</span>code
							<span class="token comment">// this.autoLogin()</span>
							<span class="token keyword">let</span> shareId <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'shareId'</span><span class="token punctuation">)</span>
							uni<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
								desc<span class="token operator">:</span> <span class="token string">'登录'</span><span class="token punctuation">,</span>
								<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
									console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'33333333'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
									<span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token punctuation">{</span>
										code<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wxAuthorityCode<span class="token punctuation">,</span>
										encryptedData<span class="token operator">:</span> result<span class="token punctuation">.</span>encryptedData<span class="token punctuation">,</span>
										iv<span class="token operator">:</span> result<span class="token punctuation">.</span>iv<span class="token punctuation">,</span>
										shareId
									<span class="token punctuation">}</span>
									console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'33333333shareId'</span><span class="token punctuation">,</span> shareId<span class="token punctuation">)</span>
									console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'33333333登录参数'</span><span class="token punctuation">,</span> formData<span class="token punctuation">)</span>
									<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'登录成功·'</span><span class="token punctuation">)</span>
										<span class="token function">resolve</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span>
								<span class="token punctuation">}</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'scence'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">!==</span> <span class="token number">1154</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
									title<span class="token operator">:</span> <span class="token string">&quot;获取微信临时登录凭证失败&quot;</span><span class="token punctuation">,</span>
									icon<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>

			<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ego/" class="prev router-link-active">
        概览
      </a></span> <span class="next"><a href="/ego/ego_pc.html">
        买家PC端
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f4e7372f.js" defer></script><script src="/assets/js/2.5644ef08.js" defer></script><script src="/assets/js/15.f07bf7f1.js" defer></script>
  </body>
</html>
